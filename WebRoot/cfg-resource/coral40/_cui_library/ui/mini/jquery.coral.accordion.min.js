/*!
 *
 * Depends:
 *	jquery.coral.core.js
 *	jquery.coral.component.js
 */
(function(a,b){a.component("coral.accordion",{version:"4.0.1",options:{active:0,animate:{params:{},duration:300,easing:"swing"},collapsible:false,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"icon-arrow-down",header:"icon-arrow-right2"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var c=this.options;c.icons=a.coral.toFunction(c.icons);this.prevShow=this.prevHide=a();this.element.addClass("coral-accordion ctrl-init ctrl-init-accordion coral-component coral-helper-reset").attr("role","tablist");if(!c.collapsible&&(c.active===false||c.active==null)){c.active=0}this._processPanels();if(c.active<0){c.active+=this.headers.length}this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:!this.active.length?a():this.active.next()}},_createIcons:function(){var d=this,c=this.options.icons;if(c){a("<span>").addClass("coral-accordion-header-icon icon "+c.header).prependTo(this.headers);this.active.children(".coral-accordion-header-icon").removeClass(c.header).addClass(c.activeHeader);this.headers.each(function(){var e=a.parser.parseOptions(this);if(e.collapsible==false){a(this).children(".coral-accordion-header-icon").remove()}else{a(this).addClass("coral-accordion-icons")}})}},_destroyIcons:function(){this.headers.removeClass("coral-accordion-icons").children(".coral-accordion-header-icon").remove()},_destroy:function(){var c;this.element.removeClass("coral-accordion coral-component coral-helper-reset").removeAttr("role");this.headers.removeClass("coral-accordion-header coral-accordion-header-active coral-state-default coral-corner-all coral-state-active coral-state-disabled coral-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId();
this._destroyIcons();c=this.headers.next().removeClass("coral-helper-reset coral-widget-content coral-corner-bottom coral-accordion-content coral-accordion-content-active coral-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId();if(this.options.heightStyle!=="content"){c.css("height","")}},_setOption:function(c,d){if(c==="active"){this._activate(d);return}if(c==="event"){if(this.options.event){this._off(this.headers,this.options.event)}this._setupEvents(d)}this._super(c,d);if(c==="collapsible"&&!d&&this.options.active===false){this._activate(0)}if(c==="icons"){this._destroyIcons();if(d){this._createIcons()}}if(c==="disabled"){this.element.toggleClass("coral-state-disabled",!!d).attr("aria-disabled",d);this.headers.add(this.headers.next()).toggleClass("coral-state-disabled",!!d)}},_keydown:function(f){if(f.altKey||f.ctrlKey){return}var g=a.coral.keyCode,e=this.headers.length,c=this.headers.index(f.target),d=false;switch(f.keyCode){case g.RIGHT:case g.DOWN:d=this.headers[(c+1)%e];break;case g.LEFT:case g.UP:d=this.headers[(c-1+e)%e];break;case g.SPACE:case g.ENTER:this._eventHandler(f);break;case g.HOME:d=this.headers[0];break;case g.END:d=this.headers[e-1];break}if(d){a(f.target).attr("tabIndex",-1);a(d).attr("tabIndex",0);d.focus();f.preventDefault()}},_panelKeyDown:function(c){if(c.keyCode===a.coral.keyCode.UP&&c.ctrlKey){a(c.currentTarget).prev().focus()}},refresh:function(){var c=this.options;this._processPanels();if((c.active===false&&c.collapsible===true)||!this.headers.length){c.active=false;this.active=a()}else{if(c.active===false){this._activate(0)}else{if(this.active.length&&!a.contains(this.element[0],this.active[0])){if(this.headers.length===this.headers.find(".coral-state-disabled").length){c.active=false;this.active=a()}else{this._activate(Math.max(0,c.active-1))}}else{c.active=this.headers.index(this.active)}}}this._destroyIcons();this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("coral-accordion-header coral-state-default coral-corner-all");
this.headers.next().addClass("coral-accordion-content coral-helper-reset coral-component-content coral-corner-bottom").filter(":not(.coral-accordion-content-active)").hide()},_refresh:function(){var f,d=this.options,c=d.heightStyle,e=this.element.parent();this.active=this._findActive(d.active).addClass("coral-accordion-header-active coral-state-active coral-corner-top").removeClass("coral-corner-all");this.active.next().addClass("coral-accordion-content-active").show();this.headers.attr("role","tab").each(function(){var j=a(this),i=j.uniqueId().attr("id"),g=j.next(),h=g.uniqueId().attr("id");j.attr("aria-controls",h);g.attr("aria-labelledby",i)}).next().attr("role","tabpanel");this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide();if(!this.active.length){this.headers.eq(0).attr("tabIndex",0)}else{this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"})}this._createIcons();this._setupEvents(d.event);if(c==="fill"){f=e.height();this.element.siblings(":visible").each(function(){var h=a(this),g=h.css("position");if(g==="absolute"||g==="fixed"){return}f-=h.outerHeight(true)});this.headers.each(function(){f-=a(this).outerHeight(true)});this.headers.next().each(function(){a(this).height(Math.max(0,f-a(this).innerHeight()+a(this).height()))}).addClass("overflow-auto")}else{if(c==="auto"){f=0;this.headers.next().each(function(){f=Math.max(f,a(this).css("height","").height())}).height(f)}}this.headers.each(function(){var g=a.parser.parseOptions(this);if(g.collapsible==false){a(this).next().addClass("hidden")}})},_activate:function(c){var d=this._findActive(c)[0];if(d===this.active[0]){return}d=d||this.active[0];this._eventHandler({target:d,currentTarget:d,preventDefault:a.noop})},_findActive:function(c){return typeof c==="number"?this.headers.eq(c):a()},_setupEvents:function(d){var c={keydown:"_keydown"};if(d){a.each(d.split(" "),function(f,e){c[e]="_eventHandler"
})}this._off(this.headers.add(this.headers.next()));this._on(this.headers,c);this._on(this.headers.next(),{keydown:"_panelKeyDown"});this._hoverable(this.headers);this._focusable(this.headers)},_eventHandler:function(c){var k=this.options,f=this.active,g=a(c.currentTarget),i=g[0]===f[0],d=i&&k.collapsible,e=d?a():g.next(),h=f.next(),j={oldHeader:f,oldPanel:h,newHeader:d?a():g,newPanel:e,headerOptions:a.parser.parseOptions((d?a():g))};c.preventDefault();if((i&&!k.collapsible)||(this._trigger("beforeActivate",c,j)===false)){return}k.active=d?false:this.headers.index(g);this.active=i?a():g;this._toggle(j);f.removeClass("coral-accordion-header-active coral-state-active");if(k.icons){f.children(".coral-accordion-header-icon").removeClass(k.icons.activeHeader).addClass(k.icons.header)}if(!i){g.removeClass("coral-corner-all").addClass("coral-accordion-header-active coral-state-active coral-corner-top");if(k.icons){g.children(".coral-accordion-header-icon").removeClass(k.icons.header).addClass(k.icons.activeHeader)}g.next().addClass("coral-accordion-content-active")}},_toggle:function(e){var c=e.newPanel,d=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(true,true);this.prevShow=c;this.prevHide=d;if(this.options.animate){this._animate(c,d,e)}else{d.hide();c.show();this._toggleComplete(e)}d.attr({"aria-hidden":"true"});d.prev().attr("aria-selected","false");if(c.length&&d.length){d.prev().attr({tabIndex:-1,"aria-expanded":"false"})}else{if(c.length){this.headers.filter(function(){return a(this).attr("tabIndex")===0}).attr("tabIndex",-1)}}c.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(c,k,g){var j,i,f,h=this,l=0,m=c.length&&(!k.length||(c.index()<k.index())),e=this.options.animate||{},n=m&&e.down||e,d=function(){h._toggleComplete(g)};if(typeof n==="number"){f=n}if(typeof n==="string"){i=n}i=i||n.easing||e.easing;f=f||n.duration||e.duration;if(!k.length){return c.animate(this.showProps,f,i,d)
}if(!c.length){return k.animate(this.hideProps,f,i,d)}j=c.show().outerHeight();k.animate(this.hideProps,{duration:f,easing:i,step:function(o,p){p.now=Math.round(o)}});c.hide().animate(this.showProps,{duration:f,easing:i,complete:d,step:function(o,p){p.now=Math.round(o);if(p.prop!=="height"){l+=p.now}else{if(h.options.heightStyle!=="content"){l=0}}}})},_toggleComplete:function(d){var c=d.oldPanel;c.removeClass("coral-accordion-content-active").prev().removeClass("coral-corner-top").addClass("coral-corner-all");if(c.length){c.parent()[0].className=c.parent()[0].className}this._trigger("onActivate",null,d)}})})(jQuery);