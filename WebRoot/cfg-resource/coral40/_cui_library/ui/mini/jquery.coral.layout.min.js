(function(a){a.component("coral.layout",{version:"4.0.1",options:{onCreate:null,fit:false},layoutPanelDefault:{region:null,split:false,collapsedSize:28,minWidth:10,minHeight:10,maxWidth:10000,maxHeight:10000},_flag:false,_refresh:function(){var f=this;var b=this.element;var k=f.options;var e=f.panels;var c=a(b);if(b.tagName=="BODY"){this._fit()}else{k.fit?c.css(this._fit()):this._fit(false)}var g={top:0,left:0,width:c.width(),height:c.height()};j(this._isPanelVisible(e.expandNorth)?e.expandNorth:e.north,"n");j(this._isPanelVisible(e.expandSouth)?e.expandSouth:e.south,"s");h(this._isPanelVisible(e.expandEast)?e.expandEast:e.east,"e");h(this._isPanelVisible(e.expandWest)?e.expandWest:e.west,"w");e.center.panel("resize",g);function d(l){var m=l.panel("getOptions");return Math.min(Math.max(m.height,m.minHeight),m.maxHeight)}function i(m){var l=m.panel("getOptions");return Math.min(Math.max(l.width,l.minWidth),l.maxWidth)}function j(l,m){if(!l.length||!f._isPanelVisible(l)){return}var n=l.panel("getOptions");var o=d(l);l.panel("resize",{width:c.width(),height:o,left:0,top:(m=="n"?0:c.height()-o)});g.height-=o;if(m=="n"){g.top+=o;if(!n.split&&n.border){g.top--}}if(!n.split&&n.border){g.height++}}function h(m,n){if(!m.length||!f._isPanelVisible(m)){return}var o=m.panel("getOptions");var l=i(m);m.panel("resize",{width:l,height:g.height,left:(n=="e"?c.width()-l:0),top:g.top});g.width-=l;if(n=="w"){g.left+=l;if(!o.split&&o.border){g.left--}}if(!o.split&&o.border){g.width++}}},_create:function(){this.panels={center:a(),north:a(),south:a(),east:a(),west:a()};var d=this;var b=this.element;this.element.addClass("ctrl-init ctrl-init-layout");var e=a(b);e.addClass("coral-layout");function c(f){f.children("div").each(function(){var g=a.parser.parseOptions(this,[]);if("north,south,east,west,center".indexOf(g.region)>=0){d._add(b,g,this)}})}e.children("form").length?c(e.children("form")):c(e);e.append('<div class="coral-layout-split-proxy-h"></div><div class="coral-layout-split-proxy-v"></div>');
this._refresh();this._initCollapse()},_add:function(b,l,k){var g=this;l.region=l.region||"center";var h=this.panels;var e=a(b);var f=l.region;if(h[f].length){return}var c=a(k);if(!c.length){c=a("<div></div>").appendTo(e)}var j=a.extend({},this.layoutPanelDefault,{width:(c.length?parseInt(c[0].style.width)||c.outerWidth():"auto"),height:(c.length?parseInt(c[0].style.height)||c.outerHeight():"auto"),doSize:false,collapsible:true,componentCls:("coral-layout-panel coral-layout-panel-"+f),bodyCls:"coral-layout-body",onOpen:function(){var p=a(this).panel("header").children("div.coral-panel-tool");p.children("a.coral-panel-tool-collapse").hide();var o={north:"up",south:"down",east:"right2",west:"left"};if(!o[f]){return}var m="icon-arrow-"+o[f];var n=p.children("a."+m);if(!n.length){n=a('<a href="javascript:void(0)"></a>').addClass("icon "+m).appendTo(p)}n.unbind("click").bind("click",{dir:f},function(q){g._collapse(q.data.dir);return false});a(this).panel("getOptions").collapsible?n.show():n.hide()}},l);c.panel(j);h[f]=c;if(c.panel("getOptions").split){var i=c.panel("component");i.addClass("coral-layout-split-"+f);var d="";if(f=="north"){d="s"}if(f=="south"){d="n"}if(f=="east"){d="w"}if(f=="west"){d="e"}i.resizable(a.extend({handles:d,start:function(o){g._flag=true;if(f=="north"||f=="south"){var m=a(">div.coral-layout-split-proxy-v",b)}else{var m=a(">div.coral-layout-split-proxy-h",b)}var n=0;var p={display:"block"};if(f=="north"){p.top=parseInt(i.css("top"))+i.outerHeight()-m.height();p.left=parseInt(i.css("left"));p.width=i.outerWidth();p.height=m.height()}else{if(f=="south"){p.top=parseInt(i.css("top"));p.left=parseInt(i.css("left"));p.width=i.outerWidth();p.height=m.height()}else{if(f=="east"){p.top=parseInt(i.css("top"))||0;p.left=parseInt(i.css("left"))||0;p.width=m.width();p.height=i.outerHeight()}else{if(f=="west"){p.top=parseInt(i.css("top"))||0;p.left=i.outerWidth()-m.width();p.width=m.width();p.height=i.outerHeight()}}}}m.css(p);a('<div class="coral-layout-mask"></div>').css({left:0,top:0,width:e.width(),height:e.height()}).appendTo(e)
},resize:function(n){if(f=="north"||f=="south"){var m=a(">div.coral-layout-split-proxy-v",b);m.css("top",n.pageY-a(b).offset().top-m.height()/2)}else{var m=a(">div.coral-layout-split-proxy-h",b);m.css("left",n.pageX-a(b).offset().left-m.width()/2)}return false},helper:"coral-resizable-helper",stop:function(n,m){e.children("div.coral-layout-split-proxy-v,div.coral-layout-split-proxy-h").hide();c.panel("resize",m.size);g._refresh();g._flag=false;e.find(">div.coral-layout-mask").remove()}},l))}},_remove:function(c){var b=this.panels;if(b[c].length){b[c].panel("destroy");a(b[c]).remove();b[c]=a();var d="expand"+c.substring(0,1).toUpperCase()+c.substring(1);if(b[d]){b[d].panel("destroy");a(b[c]).remove();b[d]=undefined}}},_collapse:function(j,l){var h=this;var d=this.element;if(l==undefined){l="normal"}var i=this.panels;var c=i[j];var k=c.panel("getOptions");if(k.beforeCollapse.call(c)==false){return}var f="expand"+j.substring(0,1).toUpperCase()+j.substring(1);if(!i[f]){i[f]=e(j);i[f].panel("component").bind("click",function(){var m=g();c.panel("expand",false).panel("open").panel("resize",m.collapse);c.panel("component").animate(m.expand,function(){a(this).unbind(".layout").bind("mouseleave.layout",{region:j},function(n){if(h._flag==true){return}h._collapse(n.data.region)})});return false})}var b=g();if(!this._isPanelVisible(i[f])){i.center.panel("resize",b.resizeC)}c.panel("component").animate(b.collapse,l,function(){c.panel("collapse",false).panel("close");i[f].panel("open").panel("resize",b.expandP);a(this).unbind(".layout")});function e(n){var m;if(n=="east"){m="icon icon-arrow-left"}else{if(n=="west"){m="icon icon-arrow-right2"}else{if(n=="north"){m="icon icon-arrow-down"}else{if(n=="south"){m="icon icon-arrow-up"}}}}var o=a("<div></div>").appendTo(d);o.panel(a.extend({},h.layoutPanelDefault,{componentCls:("coral-layout-expand coral-layout-expand-"+n),title:"&nbsp;",closed:true,minWidth:0,minHeight:0,doSize:false,tools:[{iconCls:m,handler:function(){h._expand(j);return false
}}]}));o.panel("component").hover(function(){a(this).addClass("coral-layout-expand-over")},function(){a(this).removeClass("coral-layout-expand-over")});return o}function g(){var q=a(d);var n=i.center.panel("getOptions");var m=k.collapsedSize;if(j=="east"){var p=n.width+k.width-m;if(k.split||!k.border){p++}return{resizeC:{width:p},expand:{left:q.width()-k.width},expandP:{top:n.top,left:q.width()-m,width:m,height:n.height},collapse:{left:q.width(),top:n.top,height:n.height}}}else{if(j=="west"){var p=n.width+k.width-m;if(k.split||!k.border){p++}return{resizeC:{width:p,left:m-1},expand:{left:0},expandP:{left:0,top:n.top,width:m,height:n.height},collapse:{left:-k.width,top:n.top,height:n.height}}}else{if(j=="north"){var o=n.height;if(!h._isPanelVisible(i.expandNorth)){o+=k.height-m+((k.split||!k.border)?1:0)}i.east.add(i.west).add(i.expandEast).add(i.expandWest).panel("resize",{top:m-1,height:o});return{resizeC:{top:m-1,height:o},expand:{top:0},expandP:{top:0,left:0,width:q.width(),height:m},collapse:{top:-k.height,width:q.width()}}}else{if(j=="south"){var o=n.height;if(!h._isPanelVisible(i.expandSouth)){o+=k.height-m+((k.split||!k.border)?1:0)}i.east.add(i.west).add(i.expandEast).add(i.expandWest).panel("resize",{height:o});return{resizeC:{height:o},expand:{top:q.height()-k.height},expandP:{top:q.height()-m,left:0,width:q.width(),height:m},collapse:{top:q.height(),width:q.width()}}}}}}}},_expand:function(h){var f=this;var c=this.element;var g=this.panels;var b=g[h];var i=b.panel("getOptions");if(i.beforeExpand.call(b)==false){return}var j=e();var d="expand"+h.substring(0,1).toUpperCase()+h.substring(1);if(g[d]){g[d].panel("close");b.panel("component").stop(true,true);b.panel("expand",false).panel("open").panel("resize",j.collapse);b.panel("component").animate(j.expand,function(){f._refresh()})}function e(){var l=a(c);var k=g.center.panel("getOptions");if(h=="east"&&g.expandEast){return{collapse:{left:l.width(),top:k.top,height:k.height},expand:{left:l.width()-g.east.panel("getOptions").width}}
}else{if(h=="west"&&g.expandWest){return{collapse:{left:-g.west.panel("getOptions").width,top:k.top,height:k.height},expand:{left:0}}}else{if(h=="north"&&g.expandNorth){return{collapse:{top:-g.north.panel("getOptions").height,width:l.width()},expand:{top:0}}}else{if(h=="south"&&g.expandSouth){return{collapse:{top:l.height(),width:l.width()},expand:{top:l.height()-g.south.panel("getOptions").height}}}}}}}},_isPanelVisible:function(b){if(!b){return false}if(b.length){return b.panel("component").is(":visible")}else{return false}},_initCollapse:function(){var b=this.panels;if(b.east.length&&b.east.panel("getOptions").collapsed){this._collapse("east",0)}if(b.west.length&&b.west.panel("getOptions").collapsed){this._collapse("west",0)}if(b.north.length&&b.north.panel("getOptions").collapsed){this._collapse("north",0)}if(b.south.length&&b.south.panel("getOptions").collapsed){this._collapse("south",0)}},_fit:function(b){return a.coral.panel.fit(this.element,b)},_destroy:function(){this.element.children().remove();this.element.detach()},refresh:function(){this._refresh()},panel:function(b){return this.panels[b]},collapse:function(b){this._collapse(b)},expand:function(b){this._expand(b)},add:function(b){this._add(this.element,b);this._refresh();if(this.panels[b.region].panel("getOptions").collapsed){this._collapse(b.region,0)}},remove:function(b){this._remove(b);this._refresh()},resize:function(h,i){var g=h;var c=this.element;if(i!==undefined){var d=this.panels[i];var j=d.panel("component").outerHeight();var e=d.panel("component").outerWidth();d.panel("resize",h);var b=d.panel("component").outerHeight();var f=d.panel("component").outerWidth();g.height=a(c).height()+b-j;g.width=a(c).width()+f-e}a(c).css(g);this._refresh()}})})(jQuery);